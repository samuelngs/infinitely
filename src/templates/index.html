<html>
<head>
    <title>Testing</title>
    <script src="static/js/app.min.js"></script>
</head>

<body>
    <input id="channel" type="text">
    <button id="join">Join</button>
    <input id="input" type="text">
    <button id="submit">Send Message</button>
    <div id="display"></div>
</body>

<script>

    var ws = new App.Module.WebSocket('ws://127.0.0.1:3000/sync');

    var channel = document.querySelector('#channel'),
        join = document.querySelector('#join');

    var btn = document.querySelector('#submit'),
        ipt = document.querySelector('#input'),
        dsp = document.querySelector('#display');

    var append = function(type, msg) {
        var el = document.createElement('p'),
            t  = document.createTextNode('[' + type + '] ' + ipt.value);
        el.appendChild(t);
        dsp.appendChild(el);
    };

    var subscribe = function(e) {
        if (typeof channel.value === 'string' && channel.value.trim().length > 0) {
            ws.subscribe(channel.value);
        }
    };

    var send = function(e) {
        if (typeof ipt.value === 'string' && ipt.value.trim().length > 0) {
            ws.send(channel.value, ipt.value);
            append('SENT', ipt.value);
        }
    };

    ws.on('message', function(msg) {
        console.log(msg)
        append('RECE', msg);
    });

    channel.addEventListener('keydown', function(e) {
        if (e.keyCode == 13) {
            subscribe();
        }
    });

    join.addEventListener('click', function(e) {
        subscribe();
    });

    ipt.addEventListener('keydown', function(e) {
        if (e.keyCode == 13) {
            send(e);
        }
    });

    btn.addEventListener('click', function(e) {
        e.preventDefault();
        send(e);
    });

</script>
</html>
